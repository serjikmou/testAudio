<!DOCTYPE html>
<html>
  <head>
    <title>WebRTC Audio Source Switching</title>
    <style>
      video {
        width: 480px;
        height: 360px;
      }
    </style>
  </head>
  <body>
    <video id="local-video" autoplay></video>
    <video id="remote-video" autoplay></video>
    <button id="switch-audio-source">Switch Audio Source</button>
    <button id="switch-speaker-source">Switch speaker Source</button>

    <script>
      const localVideo = document.getElementById("local-video");
      const remoteVideo = document.getElementById("remote-video");
      const switchAudioSourceButton = document.getElementById(
        "switch-audio-source"
      );
      const switchSpeakerSourceButton = document.getElementById(
        "switch-speaker-source"
      );

      let localStream;
      let remoteStream;
      let currentAudioSource = "speaker";

      // Initialize WebRTC
      navigator.mediaDevices
        .getUserMedia({ video: true, audio: true })
        .then((stream) => {
          localStream = stream;
          localVideo.srcObject = stream;
        })
        .catch((error) => {
          console.error("Error getting media devices:", error);
        });

      // Example peer connection setup (omitted for brevity)
      // ...

      switchAudioSourceButton.addEventListener("click", () => {
        if (currentAudioSource === "speaker") {
          switchToHeadset();
        } else {
          switchToSpeaker();
        }
      });

      switchSpeakerSourceButton.addEventListener("click", () => {
        switchToSpeaker();
      });

      function switchToHeadset() {
        const audioTracks = localStream.getAudioTracks();
        audioTracks.forEach((track) => {
          track.stop();
        });

        navigator.mediaDevices
          .getUserMedia({ audio: { deviceId: { exact: "headset-device-id" } } })
          .then((stream) => {
            localStream = stream;
            localVideo.srcObject = stream;
            currentAudioSource = "headset";
            switchAudioSourceButton.textContent = "Switch to Speaker";
          })
          .catch((error) => {
            console.error("Error switching to headset:", error);
          });
      }

      function switchToSpeaker() {
        const audioTracks = localStream.getAudioTracks();
        audioTracks.forEach((track) => {
          track.stop();
        });

        navigator.mediaDevices
          .getUserMedia({ audio: true })
          .then((stream) => {
            localStream = stream;
            localVideo.srcObject = stream;
            currentAudioSource = "speaker";
            switchAudioSourceButton.textContent = "Switch to Headset";
          })
          .catch((error) => {
            console.error("Error switching to speaker:", error);
          });
      }
    </script>
  </body>
</html>
