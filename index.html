<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>WebRTC Audio Source Switch</title>
  </head>
  <body>
    <button id="switchToSpeaker">Switch to Speaker</button>
    <button id="switchToHeadset">Switch to Headset</button>
    <audio id="remoteAudio" autoplay controls></audio>
    <script>
      const remoteAudio = document.getElementById("remoteAudio");
      const switchToSpeakerBtn = document.getElementById("switchToSpeaker");
      const switchToHeadsetBtn = document.getElementById("switchToHeadset");

      let localStream;
      let peerConnection;

      async function init() {
        localStream = await navigator.mediaDevices.getUserMedia({
          audio: true,
          video: false,
        });
        remoteAudio.srcObject = localStream;

        peerConnection = new RTCPeerConnection();

        peerConnection.addEventListener("track", (event) => {
          remoteAudio.srcObject = event.streams[0];
        });

        localStream.getTracks().forEach((track) => {
          peerConnection.addTrack(track, localStream);
        });

        switchToSpeakerBtn.addEventListener("click", switchToSpeaker);
        switchToHeadsetBtn.addEventListener("click", switchToHeadset);
      }

      async function switchToSpeaker() {
        await switchAudioOutput("speaker");
      }

      async function switchToHeadset() {
        await switchAudioOutput("headset");
      }

      async function switchAudioOutput(deviceType) {
        const devices = await navigator.mediaDevices.enumerateDevices();
        const audioOutputDevices = devices.filter(
          (device) => device.kind === "audiooutput"
        );

        let targetDevice;
        if (deviceType === "speaker") {
          targetDevice = audioOutputDevices.find((device) =>
            device.label.toLowerCase().includes("speaker")
          );
        } else if (deviceType === "headset") {
          targetDevice = audioOutputDevices.find((device) =>
            device.label.toLowerCase().includes("headset")
          );
        }

        if (targetDevice) {
          try {
            await remoteAudio.setSinkId(targetDevice.deviceId);
            console.log(`Switched to ${targetDevice.label}`);
          } catch (error) {
            console.error("Error switching audio output device:", error);
          }
        } else {
          console.error(`No ${deviceType} found`);
        }
      }

      init();
    </script>
  </body>
</html>
