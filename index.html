<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>WebRTC Audio Device Switcher</title>
  </head>
  <body>
    <h1>WebRTC Audio Device Switcher</h1>
    <video id="remoteVideo" autoplay playsinline></video>
    <div>
      <label for="audioOutput">Select Audio Output Device:</label>
      <select id="audioOutput"></select>
    </div>
    <script>
      // Get references to the DOM elements
      const remoteVideo = document.getElementById("remoteVideo");
      const audioOutputSelect = document.getElementById("audioOutput");

      // Get user media and set up WebRTC connection
      async function setupWebRTC() {
        try {
          // Get the user's media (audio and video)
          const stream = await navigator.mediaDevices.getUserMedia({
            audio: true,
            video: true,
          });

          // Display the local stream in the video element
          remoteVideo.srcObject = stream;

          // TODO: Set up your WebRTC connection here and add the remote stream to the video element
          // For example: pc.ontrack = (event) => remoteVideo.srcObject = event.streams[0];

          // Enumerate devices and populate the audio output select box
          const devices = await navigator.mediaDevices.enumerateDevices();
          const audioOutputDevices = devices.filter(
            (device) => device.kind === "audiooutput"
          );
          populateAudioOutputOptions(audioOutputDevices);

          // Handle audio output device change
          audioOutputSelect.addEventListener("change", (event) => {
            const deviceId = event.target.value;
            switchAudioOutputDevice(deviceId);
          });
        } catch (error) {
          console.error("Error accessing media devices.", error);
        }
      }

      // Populate the audio output select box
      function populateAudioOutputOptions(devices) {
        audioOutputSelect.innerHTML = "";
        devices.forEach((device) => {
          const option = document.createElement("option");
          option.value = device.deviceId;
          option.text = device.label || `Device ${device.deviceId}`;
          audioOutputSelect.appendChild(option);
        });
      }

      // Switch the audio output device
      async function switchAudioOutputDevice(deviceId) {
        if (typeof remoteVideo.setSinkId !== "undefined") {
          try {
            await remoteVideo.setSinkId(deviceId);
            console.log(`Audio output device set to ${deviceId}`);
          } catch (error) {
            console.error("Error setting audio output device:", error);
          }
        } else {
          console.warn("setSinkId is not supported in this browser.");
        }
      }

      // Initialize WebRTC setup
      setupWebRTC();
    </script>
  </body>
</html>
